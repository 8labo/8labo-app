<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>8LABO ACADEMY MASTER</title>
    <!-- 必要なライブラリをCDNから読み込み -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #fcfdfe; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .animate-in { animation: fadeIn 0.3s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        input { width: 100%; border-radius: 1.2rem; border: 1px solid #e2e8f0; padding: 1.1rem; font-weight: bold; outline: none; background: white; color: #1e293b; font-size: 16px; }
        .error-box { background: #fef2f2; border: 1px solid #fee2e2; color: #ef4444; padding: 1rem; border-radius: 1rem; font-size: 13px; font-weight: bold; margin-top: 1rem; line-height: 1.5; }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- Reactコードの記述 -->
    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- デプロイ後の最新URLを貼り付けてください ---
        const GAS_URL = "https://script.google.com/macros/s/AKfycbykEwGRci1xg7dSD5CLFoT8ocWQicYoRV2RIqu1muB8V7mmdU7cIFl-wJuVXaRh9B9wLg/exec"; 

        const App = () => {
            const [studentInfo, setStudentInfo] = useState(null);
            const [loginId, setLoginId] = useState("");
            const [password, setPassword] = useState("");
            const [isSubmitting, setIsSubmitting] = useState(false);
            const [errorMessage, setErrorMessage] = useState("");

            const handleLogin = async (e) => {
                if (e) e.preventDefault();
                setErrorMessage("");
                setIsSubmitting(true);
                
                try {
                    // 1. 通信テスト(Ping)による診断
                    const pingUrl = `${GAS_URL}?action=ping`;
                    const respPing = await fetch(pingUrl).catch(() => null);
                    if (!respPing) {
                        setErrorMessage("Googleのサーバーに接続できません。URLが間違っているか、GASのデプロイ設定が『全員(Anyone)』になっていない可能性があります。");
                        setIsSubmitting(false); return;
                    }

                    // 2. 本番ログイン処理
                    const url = `${GAS_URL}?action=getStudent&id=${encodeURIComponent(loginId.trim())}&pass=${encodeURIComponent(password.trim())}`;
                    const resp = await fetch(url);
                    const data = await resp.json();
                    
                    if (data.status === "success") {
                        setStudentInfo(data.student);
                    } else {
                        setErrorMessage(data.message);
                    }
                } catch (err) {
                    setErrorMessage("接続エラーが発生しました。インターネット環境を確認し、数分後に再度お試しください。");
                } finally {
                    setIsSubmitting(false);
                }
            };

            return (
                <div className="w-full max-w-[400px] mx-auto min-h-screen bg-[#005bac] flex flex-col items-center justify-center p-8 text-white">
                    {studentInfo ? (
                        <div className="text-center animate-in">
                            <div className="w-20 h-20 bg-white rounded-[1.8rem] flex items-center justify-center mb-6 mx-auto shadow-2xl rotate-3 text-[#005bac] font-black text-4xl italic text-center">8</div>
                            <h1 className="text-2xl font-black italic mb-4">LOGIN SUCCESS!</h1>
                            <p className="text-lg">{studentInfo.name} 様、ようこそ</p>
                            <button onClick={() => setStudentInfo(null)} className="mt-8 opacity-50 underline">Logout</button>
                        </div>
                    ) : (
                        <div className="w-full max-w-xs animate-in">
                            <div className="w-20 h-20 bg-white rounded-[1.8rem] flex items-center justify-center mb-6 shadow-2xl rotate-3 text-[#005bac] font-black text-4xl italic">8</div>
                            <h1 className="text-2xl font-black mb-10 italic uppercase tracking-tighter leading-none">8LABO ACADEMY</h1>
                            
                            <form onSubmit={handleLogin} className="space-y-4">
                                <input 
                                    type="text" 
                                    placeholder="塾生IDを入力" 
                                    value={loginId} 
                                    onChange={e=>setLoginId(e.target.value)} 
                                    autoComplete="username"
                                />
                                <input 
                                    type="password" 
                                    placeholder="パスワード" 
                                    value={password} 
                                    onChange={e=>setPassword(e.target.value)} 
                                    autoComplete="current-password"
                                />
                                <button 
                                    type="submit" 
                                    disabled={isSubmitting} 
                                    className="w-full bg-[#f39800] py-4 rounded-xl font-black shadow-xl active:scale-95 italic transition-all disabled:opacity-50"
                                >
                                    {isSubmitting ? "認証中..." : "LOGIN"}
                                </button>
                            </form>

                            {errorMessage && (
                                <div className="error-box animate-in">
                                    ⚠️ {errorMessage}
                                </div>
                            )}

                            <div className="mt-8 text-center opacity-40 text-[10px] font-bold uppercase tracking-widest leading-loose">
                                8LABO Management System<br/>v1.0.1 Stable Build
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
