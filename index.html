<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>8LABO ACADEMY</title>
    <!-- å®‰å®šæ€§ã‚’é‡è¦–ã—ãŸãƒ©ã‚¤ãƒ–ãƒ©ãƒªèª­ã¿è¾¼ã¿ -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>
    <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #fcfdfe; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; overflow-x: hidden; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .animate-in { animation: fadeIn 0.3s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .slide-up { animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        
        /* å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ è¨­å®š */
        input, select { 
            width: 100%; border-radius: 1.2rem; border: 2px solid #e2e8f0 !important; 
            padding: 1.1rem !important; font-weight: bold !important; 
            background: #ffffff !important; color: #1e293b !important; 
            font-size: 16px !important; position: relative; z-index: 50;
            appearance: none; -webkit-appearance: none;
        }
        input:focus { border-color: #005bac !important; outline: none; box-shadow: 0 0 0 4px rgba(0,91,172,0.1); }
        
        /* ã€é‡è¦ã€‘ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã®å¼·åˆ¶ã‚¹ã‚¿ã‚¤ãƒ«ï¼šGitHubä¸Šã§ã‚‚ç¢ºå®Ÿã«ã‚ªãƒ¬ãƒ³ã‚¸è‰²ã«ã™ã‚‹ */
        .btn-login-orange {
            background-color: #f39800 !important;
            color: #ffffff !important;
            font-weight: 900 !important;
            padding: 1.1rem !important;
            border-radius: 1.2rem !important;
            box-shadow: 0 10px 20px -5px rgba(243,152,0,0.5) !important;
            text-align: center !important;
            display: block !important;
            width: 100% !important;
            border: none !important;
            cursor: pointer !important;
            text-transform: uppercase !important;
            font-style: italic !important;
        }
        .btn-login-orange:active { transform: scale(0.97); opacity: 0.9; }

        .btn-primary-blue {
            background-color: #005bac !important;
            color: #ffffff !important;
            font-weight: 900 !important;
            padding: 1.1rem !important;
            border-radius: 1.2rem !important;
            width: 100% !important;
            border: none !important;
            box-shadow: 0 10px 20px -5px rgba(0,91,172,0.3) !important;
        }

        .card { background: white; border-radius: 2.2rem; border: 1px solid white; box-shadow: 0 10px 25px -5px rgba(0,0,0,0.05); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- æœ¬ç•ªæ¥ç¶šè¨­å®šï¼šæœ€æ–°ã®GAS URLã‚’è¨­å®šæ¸ˆã¿ ---
        const GAS_URL = "https://script.google.com/macros/s/AKfycbzAjc4CW_1hOxcOO7FB8Xv4PznSvHYxoyYs7clffJI8Fk9qscmYsRSp7btnaB7TTT-G6Q/exec"; 
        const GOOGLE_CALENDAR_EMBED_URL = "https://calendar.google.com/calendar/embed?src=ja.japanese%23holiday%40group.v.calendar.google.com&ctz=Asia%2FTokyo";

        const Icon = ({ name, size = 24, className = "" }) => {
            const icons = {
                ChevronLeft: <polyline points="15 18 9 12 15 6"/>,
                ChevronRight: <polyline points="9 18 15 12 9 6"/>,
                CheckCircle: <g><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></g>,
                Lock: <g><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></g>,
                Home: <g><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></g>,
                Calendar: <g><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></g>,
                MessageCircle: <path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"/>,
                TrendingUp: <g><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></g>,
                BookOpen: <g><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></g>,
                AlertCircle: <g><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></g>,
                Star: <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>,
                X: <g><line x1="18" x2="6" y1="6" y2="18"/><line x1="6" x2="18" y1="6" y2="18"/></g>,
                Send: <g><line x1="22" x2="11" y1="2" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></g>,
                RefreshCcw: <g><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M16 16h5v5"/></g>,
                User: <g><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></g>
            };
            return (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    {icons[name] || null}
                </svg>
            );
        };

        const App = () => {
            const [view, setView] = useState('login'); 
            const [studentInfo, setStudentInfo] = useState(null);
            const [isSubmitting, setIsSubmitting] = useState(false);
            const [allEvents, setAllEvents] = useState([]);

            const [loginId, setLoginId] = useState("");
            const [loginPass, setLoginPass] = useState("");
            const [regForm, setRegForm] = useState({ name: "", kana: "", school: "", grade: "å°å­¦1å¹´", email: "" });
            const [regResult, setRegResult] = useState(null);
            const [newPass, setNewPass] = useState("");
            
            const [selectedNotice, setSelectedNotice] = useState(null);
            const [selectedEvent, setSelectedEvent] = useState(null);
            const [signupSuccess, setSignupSuccess] = useState(false);
            const [absenceDate, setAbsenceDate] = useState("");
            const [makeupOption, setMakeupOption] = useState("later");
            const [makeupDate, setMakeupDate] = useState("");
            const [formStatus, setFormStatus] = useState("");
            const [readNoticeIds, setReadNoticeIds] = useState([]);

            const notices = [
                { id: 1, date: '2026.01.31', title: '2æœˆã®æ¸¬å®šä¼šã«ã¤ã„ã¦', body: 'æ¥é€±ã‹ã‚‰å…‰é›»ç®¡ã‚’ä½¿ã£ãŸæ¸¬å®šã‚’è¡Œã„ã¾ã™ã€‚ãƒ™ã‚¹ãƒˆã‚¿ã‚¤ãƒ ã‚’ç›®æŒ‡ã—ã¦é ‘å¼µã‚Šã¾ã—ã‚‡ã†ï¼' },
                { id: 2, date: '2026.01.25', title: 'æ©Ÿèƒ½ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã®ãŠçŸ¥ã‚‰ã›', body: 'ã‚¢ãƒ—ãƒªå†…ã§ã‚¤ãƒ™ãƒ³ãƒˆç”³ã—è¾¼ã¿ã‚„æ¬ å¸­é€£çµ¡ãŒæ­£å¼ã«åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚' }
            ];

            const handleLogin = async (e) => {
                if (e) e.preventDefault();
                if (!loginId || !loginPass) return;
                setIsSubmitting(true);
                try {
                    const resp = await fetch(`${GAS_URL}?action=getStudent&id=${loginId.trim()}&pass=${loginPass.trim()}`);
                    const data = await resp.json();
                    if (data.status === "success") {
                        setStudentInfo(data.student);
                        fetchSchedule();
                        if (data.student.isFirstLogin) setView('first-pass');
                        else setView('home');
                    } else { alert("ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—: " + data.message); }
                } catch (err) { alert("é€šä¿¡ã‚¨ãƒ©ãƒ¼ï¼šGASã®ãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚"); }
                finally { setIsSubmitting(false); }
            };

            const handleRegister = async (e) => {
                e.preventDefault();
                setIsSubmitting(true);
                try {
                    const query = new URLSearchParams({ action: 'registerVisitorDetail', ...regForm }).toString();
                    const resp = await fetch(`${GAS_URL}?${query}`);
                    const data = await resp.json();
                    if (data.status === "success") { setRegResult(data); setView('reg-success'); }
                } catch (err) { alert("ç™»éŒ²ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚"); }
                finally { setIsSubmitting(false); }
            };

            const handlePassChange = async (e) => {
                e.preventDefault();
                const regex = /^(?=.*[a-z])(?=.*\d)[a-z\d]{6,12}$/;
                if (!regex.test(newPass)) { 
                    alert("æ¡ä»¶ã‚’æº€ãŸã—ã¦ã„ã¾ã›ã‚“ã€‚6ã€œ12æ–‡å­—ã®è‹±å°æ–‡å­—ã¨æ•°å­—ã‚’çµ„ã¿åˆã‚ã›ã¦ãã ã•ã„ã€‚"); 
                    return; 
                }
                setIsSubmitting(true);
                try {
                    const resp = await fetch(`${GAS_URL}?action=changePassword&id=${studentInfo.id}&newPass=${newPass}`);
                    const data = await resp.json();
                    if (data.status === "success") { setView('home'); }
                } catch (err) { alert("ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚"); }
                finally { setIsSubmitting(false); }
            };

            const fetchSchedule = async () => {
                try {
                    const resp = await fetch(`${GAS_URL}?action=getSchedule`);
                    const data = await resp.json();
                    setAllEvents(data.events || []);
                } catch (err) { console.error(err); }
            };

            const handleAbsenceSubmit = async (e) => {
                e.preventDefault();
                const now = new Date();
                const sel = new Date(absenceDate);
                if (now.toDateString() === sel.toDateString() && now.getHours() >= 14) {
                    alert("å½“æ—¥14æ™‚ä»¥é™ã®æ¬ å¸­é€£çµ¡ã¯ã€ãŠé›»è©±ã«ã¦ç›´æ¥ã”é€£çµ¡ã‚’ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚"); return;
                }
                setIsSubmitting(true);
                try {
                    const makeupStr = makeupOption === 'now' ? makeupDate : 'æœªå®š';
                    await fetch(`${GAS_URL}?action=absence&studentName=${encodeURIComponent(studentInfo.name)}&absenceDate=${absenceDate}&makeupDate=${encodeURIComponent(makeupStr)}`);
                    setFormStatus("é€ä¿¡å®Œäº†ã—ã¾ã—ãŸï¼");
                    setTimeout(() => { setFormStatus(""); setView('home'); }, 2000);
                } catch (err) { alert("é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ"); }
                finally { setIsSubmitting(false); }
            };

            const isVisitor = studentInfo?.id?.toString().startsWith("VS");
            const unreadNotices = notices.filter(n => !readNoticeIds.includes(n.id));
            const myEvents = allEvents.filter(e => e.className === "å…¨ä½“" || studentInfo?.classes?.includes(e.className));

            const SubHeader = ({ title, sub }) => (
                <div className="relative flex items-center mb-6 px-1 pt-10 animate-in">
                    <button onClick={() => setView('home')} className="w-10 h-10 bg-white shadow-lg rounded-xl flex items-center justify-center text-slate-400 active:scale-90 border border-slate-50 transition-all">
                        <Icon name="ChevronLeft" size={24} />
                    </button>
                    <div className="ml-4 text-left">
                        <h2 className="text-2xl font-black text-slate-800 italic uppercase leading-none tracking-tighter">{title}</h2>
                        <p className="text-[9px] font-black text-[#005bac] tracking-[0.2em] uppercase mt-2 opacity-50">{sub}</p>
                    </div>
                </div>
            );

            return (
                <div className="w-full max-w-[400px] mx-auto min-h-screen bg-[#fcfdfe] flex flex-col relative overflow-hidden shadow-2xl">
                    
                    {/* ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º (ãŠçŸ¥ã‚‰ã›) */}
                    {selectedNotice && (
                        <div className="fixed inset-0 z-[200] flex items-center justify-center p-6">
                            <div className="absolute inset-0 bg-slate-900/40 backdrop-blur-md" onClick={() => setSelectedNotice(null)}></div>
                            <div className="bg-white w-full rounded-[2.5rem] p-8 shadow-2xl z-10 border border-white animate-in zoom-in duration-200">
                                <div className="flex justify-between items-start mb-6"><div className="bg-blue-50 text-blue-600 p-3 rounded-2xl"><Icon name="Bell" /></div><button onClick={() => setSelectedNotice(null)} className="p-2 text-slate-300"><Icon name="X" /></button></div>
                                <h3 className="text-xl font-black text-slate-800 mb-4 text-left leading-tight">{selectedNotice.title}</h3>
                                <p className="text-sm font-medium text-slate-600 leading-relaxed py-2 text-left">{selectedNotice.body}</p>
                                <button onClick={() => { setReadNoticeIds([...readNoticeIds, selectedNotice.id]); setSelectedNotice(null); }} className="btn-primary-blue mt-6">ç¢ºèªã—ã¾ã—ãŸ</button>
                            </div>
                        </div>
                    )}

                    {/* 1. ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ */}
                    {view === 'login' && (
                        <div className="flex-1 p-10 bg-[#005bac] flex flex-col items-center justify-center text-white animate-in relative">
                            <div className="absolute top-[-10%] right-[-10%] w-64 h-64 bg-white/5 rounded-full blur-3xl pointer-events-none"></div>
                            <div className="w-20 h-20 bg-white rounded-[1.8rem] flex items-center justify-center mb-6 shadow-2xl rotate-3 text-[#005bac] font-black text-4xl italic">8</div>
                            <h1 className="text-2xl font-black mb-10 italic uppercase tracking-tighter">8LABO ACADEMY</h1>
                            <form onSubmit={handleLogin} className="w-full space-y-5">
                                <input type="text" placeholder="å€‹äººID ã¾ãŸã¯ å¡¾ç”ŸID" value={loginId} onChange={e=>setLoginId(e.target.value)} required />
                                <input type="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›" value={loginPass} onChange={e=>setLoginPass(e.target.value)} required />
                                <button type="submit" className="btn-login-orange">
                                    {isSubmitting ? "ç…§åˆä¸­..." : "ãƒ­ã‚°ã‚¤ãƒ³"}
                                </button>
                                <button type="button" onClick={() => setView('register')} className="w-full text-[11px] font-black text-white/60 uppercase tracking-widest pt-8 italic underline underline-offset-4 text-center">æ–°è¦ç™»éŒ²ï¼ˆåˆã‚ã¦ã®æ–¹ã¯ã“ã¡ã‚‰ï¼‰</button>
                            </form>
                        </div>
                    )}

                    {/* 2. æ–°è¦ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ  */}
                    {view === 'register' && (
                        <div className="flex-1 p-8 pt-16 bg-white animate-in overflow-y-auto hide-scrollbar">
                            <div className="flex items-center gap-4 mb-8"><button onClick={() => setView('login')} className="p-2 text-slate-300 active:scale-90 transition-all"><Icon name="ChevronLeft" /></button><h2 className="text-2xl font-black text-slate-800 italic uppercase">Setup Account</h2></div>
                            <form onSubmit={handleRegister} className="space-y-5 pb-10">
                                <div className="space-y-1"><label className="text-[10px] font-black text-slate-400 ml-2 uppercase text-left block">ãŠåå‰ï¼ˆãƒ•ãƒ«ãƒãƒ¼ãƒ ï¼‰</label><input type="text" placeholder="å…«ãƒ©ãƒœ å¤ªéƒ" value={regForm.name} onChange={e=>setRegForm({...regForm, name: e.target.value})} required /></div>
                                <div className="space-y-1"><label className="text-[10px] font-black text-slate-400 ml-2 uppercase text-left block">ãµã‚ŠãŒãª</label><input type="text" placeholder="ã¯ã¡ã‚‰ã¼ ãŸã‚ã†" value={regForm.kana} onChange={e=>setRegForm({...regForm, kana: e.target.value})} required /></div>
                                <div className="space-y-1"><label className="text-[10px] font-black text-slate-400 ml-2 uppercase text-left block">å­¦æ ¡å</label><input type="text" placeholder="ã€‡ã€‡å°å­¦æ ¡" value={regForm.school} onChange={e=>setRegForm({...regForm, school: e.target.value})} required /></div>
                                <div className="space-y-1"><label className="text-[10px] font-black text-slate-400 ml-2 uppercase text-left block">å­¦å¹´</label>
                                    <select value={regForm.grade} onChange={e=>setRegForm({...regForm, grade: e.target.value})}>
                                        <option>æœªå°±å­¦</option><option>å°å­¦1å¹´</option><option>å°å­¦2å¹´</option><option>å°å­¦3å¹´</option><option>å°å­¦4å¹´</option><option>å°å­¦5å¹´</option><option>å°å­¦6å¹´</option><option>ä¸­å­¦1å¹´</option><option>ä¸­å­¦2å¹´</option><option>ä¸­å­¦3å¹´</option><option>é«˜æ ¡ç”Ÿä»¥ä¸Š</option>
                                    </select>
                                </div>
                                <div className="space-y-1"><label className="text-[10px] font-black text-slate-400 ml-2 uppercase text-left block">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label><input type="email" placeholder="contact@8labo.jp" value={regForm.email} onChange={e=>setRegForm({...regForm, email: e.target.value})} required /></div>
                                <button type="submit" className="btn-primary-blue mt-4 uppercase italic">æ–°è¦ç™»éŒ²</button>
                            </form>
                        </div>
                    )}

                    {/* 3. ç™»éŒ²å®Œäº† */}
                    {view === 'reg-success' && (
                        <div className="flex-1 p-10 flex flex-col items-center justify-center animate-in text-center bg-white">
                            <div className="w-20 h-20 bg-green-100 text-green-500 rounded-full flex items-center justify-center mb-8 shadow-inner"><Icon name="CheckCircle" size={48} /></div>
                            <h2 className="text-2xl font-black text-slate-800 mb-2 italic uppercase">Register Success!</h2>
                            <div className="w-full bg-slate-50 p-8 rounded-[2.5rem] border border-slate-100 space-y-6 mb-10">
                                <div><p className="text-[10px] font-black text-slate-300 uppercase mb-1">Your ID</p><p className="text-3xl font-black text-[#005bac] tracking-tighter">{regResult.id}</p></div>
                                <div className="h-px bg-slate-200 w-1/2 mx-auto"></div>
                                <div><p className="text-[10px] font-black text-slate-300 uppercase mb-1">Temp Password</p><p className="text-2xl font-black text-slate-800 tracking-tighter">{regResult.tempPass}</p></div>
                            </div>
                            <p className="text-[11px] text-slate-400 font-medium mb-8 leading-relaxed italic px-4">â€»ã“ã®ç”»é¢ã‚’ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã§ä¿å­˜ã—ã¦ãã ã•ã„ã€‚åˆå›ãƒ­ã‚°ã‚¤ãƒ³å¾Œã«ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ãŒå¿…è¦ã§ã™ã€‚</p>
                            <button onClick={() => { setLoginId(regResult.id); setLoginPass(regResult.tempPass); setView('login'); }} className="btn-primary-blue italic">ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã¸</button>
                        </div>
                    )}

                    {/* 4. åˆå›ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ */}
                    {view === 'pass-change' || view === 'first-pass' ? (
                        <div className="flex-1 p-10 flex flex-col items-center justify-center animate-in bg-white">
                            <div className="bg-blue-50 text-blue-600 p-5 rounded-3xl mb-8 shadow-sm flex justify-center"><Icon name="Lock" size={32} /></div>
                            <h2 className="text-xl font-black text-slate-800 mb-2 italic uppercase">Security Update</h2>
                            <p className="text-slate-400 font-bold text-[10px] mb-8 text-center leading-relaxed">åˆå›ãƒ­ã‚°ã‚¤ãƒ³ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚ãƒ«ãƒ¼ãƒ«ã«æ²¿ã£ã¦ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚</p>
                            <div className="bg-blue-50/50 p-5 rounded-2xl mb-8 border border-blue-100 text-left w-full"><p className="text-[11px] font-black text-blue-800 mb-2">è¨­å®šã®ãƒ«ãƒ¼ãƒ«ï¼š</p><ul className="text-[10px] font-bold text-blue-600 list-disc list-inside space-y-1"><li>6æ–‡å­—ä»¥ä¸Šã€12æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„</li><li>ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆå°æ–‡å­—ã¨æ•°å­—ã‚’æ··ãœã¦ãã ã•ã„</li><li>è¨˜å·ã¯ä½¿ç”¨ã—ãªã„ã§ãã ã•ã„</li></ul></div>
                            <form onSubmit={handlePassChange} className="w-full space-y-4"><input type="password" placeholder="æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›" value={newPass} onChange={e=>setNewPass(e.target.value)} required /><button type="submit" className="btn-primary-blue italic">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ç¢ºå®šã™ã‚‹</button></form>
                        </div>
                    ) : null}

                    {/* 5. ãƒ›ãƒ¼ãƒ ç”»é¢ */}
                    {studentInfo && (view === 'home' || view === 'schedule' || view === 'contact' || view === 'settings' || view === 'carte' || view === 'video') && (
                        <div className="flex-1 flex flex-col animate-in">
                            <header className="bg-gradient-to-br from-[#005bac] to-[#004a8d] text-white px-8 pt-8 pb-10 relative overflow-hidden shrink-0 shadow-md text-center">
                                <div className="absolute top-[-20%] right-[-10%] w-48 h-48 bg-white/5 rounded-full blur-3xl"></div>
                                <h1 className="text-xl font-black tracking-tighter italic uppercase flex items-center justify-center gap-2 drop-shadow-sm">8LABO ACADEMY</h1>
                            </header>

                            <main className="flex-1 px-6 -mt-3 pb-32 relative z-10 space-y-6 overflow-y-auto hide-scrollbar">
                                {view === 'home' && (
                                    <div className="space-y-6 pt-4 animate-in">
                                        <button onClick={() => setView('settings')} className="w-full bg-white p-3.5 rounded-[2rem] shadow-xl flex items-center justify-between border border-white active:scale-98 transition-all">
                                            <div className="flex items-center gap-4 text-left">
                                                <div className="w-12 h-12 bg-gradient-to-br from-blue-50 to-slate-50 rounded-xl flex items-center justify-center text-3xl shadow-inner border border-slate-50 font-black italic text-[#005bac]">{isVisitor ? "V" : "S"}</div>
                                                <div><h2 className="font-black text-slate-800 text-base">{studentInfo.name} æ§˜</h2><p className="text-[10px] font-bold text-slate-400 mt-1 uppercase tracking-widest italic text-left">ID: {studentInfo.id}</p></div>
                                            </div>
                                            <Icon name="ChevronRight" size={18} className="text-slate-200" />
                                        </button>

                                        {unreadNotices.length > 0 && (
                                            <div className="space-y-2 px-1 text-left">
                                                <div className="flex items-center justify-between px-2 mb-0.5"><h3 className="text-[9px] font-black text-slate-400 uppercase tracking-[0.2em]">ãŠçŸ¥ã‚‰ã›</h3><span className="bg-[#005bac] text-white text-[7px] font-black px-1.5 py-0.5 rounded-full shadow-lg">{unreadNotices.length}</span></div>
                                                {unreadNotices.map(notice => (
                                                    <button key={notice.id} onClick={() => setSelectedNotice(notice)} className="w-full bg-white p-3.5 pr-5 rounded-[1.5rem] shadow-sm border border-white flex items-center gap-3 active:scale-98 transition-all relative text-left">
                                                        <div className="w-2 h-2 bg-[#005bac] rounded-full shadow-lg shrink-0"></div>
                                                        <span className="text-[10px] font-black text-slate-700 truncate flex-1">{notice.title}</span>
                                                        <span className="text-[7px] font-bold text-slate-300 uppercase shrink-0">{notice.date}</span>
                                                    </button>
                                                ))}
                                            </div>
                                        )}

                                        <div className="grid grid-cols-2 gap-4">
                                            <button onClick={() => setView('schedule')} className="card p-6 flex flex-col items-center justify-center gap-3 active:scale-95 transition-all"><div className="bg-indigo-500 text-white p-3.5 rounded-2xl shadow-lg shadow-indigo-100"><Icon name="Calendar" size={26} /></div><span className="text-[10px] font-black text-slate-500 uppercase">ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</span></button>
                                            <button onClick={() => setView('contact')} className="card p-6 flex flex-col items-center justify-center gap-3 active:scale-95 transition-all"><div className="bg-orange-500 text-white p-3.5 rounded-2xl shadow-lg shadow-orange-100"><Icon name="MessageCircle" size={26} /></div><span className="text-[10px] font-black text-slate-500 uppercase">æ¬ å¸­ãƒ»é€£çµ¡</span></button>
                                            <button onClick={() => isVisitor ? alert("è„³è‚²ã‚«ãƒ«ãƒ†ã¯å¡¾ç”Ÿå°‚ç”¨æ©Ÿèƒ½ã§ã™") : setView('carte')} className={`card p-6 flex flex-col items-center justify-center gap-3 active:scale-95 transition-all ${isVisitor ? 'opacity-40' : ''}`}><div className={`${isVisitor ? 'bg-slate-300' : 'bg-blue-600 shadow-blue-100'} text-white p-3.5 rounded-2xl shadow-lg`}><Icon name="TrendingUp" size={26} /></div><span className="text-[10px] font-black text-slate-500 uppercase tracking-tight">{isVisitor && <Icon name="Lock" size={10} className="inline mr-1" />}è„³è‚²ã‚«ãƒ«ãƒ†</span></button>
                                            <button onClick={() => setView('video')} className="card p-6 flex flex-col items-center justify-center gap-3 active:scale-95 transition-all"><div className="bg-slate-700 text-white p-3.5 rounded-2xl shadow-lg shadow-slate-100"><Icon name="BookOpen" size={26} /></div><span className="text-[10px] font-black text-slate-500 uppercase tracking-tight">å‚è€ƒè³‡æ–™</span></button>
                                        </div>
                                    </div>
                                )}

                                {view === 'schedule' && (
                                    <div className="space-y-6 animate-in text-left">
                                        <SubHeader title="Schedule" sub="Class Calendar" />
                                        <div className="bg-white rounded-[2.5rem] shadow-lg overflow-hidden h-[300px] border border-white"><iframe src={GOOGLE_CALENDAR_EMBED_URL} style={{ border: 0, width: '100%', height: '100%' }} frameBorder="0" scrolling="no"></iframe></div>
                                        <div className="space-y-4 px-1 pb-10">
                                            <h3 className="text-[10px] font-black text-orange-500 uppercase tracking-widest ml-4 flex items-center gap-2"><Icon name="Star" size={12} fill="currentColor" /> Upcoming Events</h3>
                                            {myEvents.length > 0 ? myEvents.map((e, idx) => (
                                                <div key={idx} className="bg-white p-5 rounded-[1.8rem] shadow-sm flex gap-4 items-center border border-slate-50">
                                                    <div className="bg-blue-50 text-[#005bac] p-3 rounded-2xl min-w-[60px] text-center font-black">
                                                        <div className="text-[9px] opacity-40 uppercase">{new Date(e.date).getMonth()+1}æœˆ</div><div className="text-xl">{new Date(e.date).getDate()}</div>
                                                    </div>
                                                    <div className="text-left"><div className="text-[8px] font-black text-blue-500 uppercase mb-1">{e.className}</div><h4 className="text-sm font-black text-slate-800 leading-tight">{e.title}</h4></div>
                                                </div>
                                            )) : <p className="text-center py-6 text-[10px] font-bold text-slate-300 italic">No events scheduled.</p>}
                                        </div>
                                    </div>
                                )}

                                {view === 'contact' && (
                                    <div className="space-y-6 animate-in text-left">
                                        <SubHeader title="Contact" sub="Absence Report" />
                                        <div className="card p-7 space-y-6">
                                            <div className="bg-blue-50 p-4 rounded-2xl flex items-center gap-3 border border-blue-100 shadow-inner">
                                                <Icon name="AlertCircle" size={20} className="text-blue-600 shrink-0" /><p className="text-[9px] text-blue-800 font-bold leading-relaxed text-left">å½“æ—¥14æ™‚ä»¥é™ã®é€£çµ¡ã¯ã€ãŠé›»è©±ã«ã¦ç›´æ¥ã”é€£çµ¡ã‚’ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚</p>
                                            </div>
                                            <form onSubmit={handleAbsenceSubmit} className="space-y-6">
                                                <div className="space-y-2"><label className="text-[9px] font-black text-slate-400 uppercase ml-1">æ¬ å¸­ã™ã‚‹æ—¥</label><input type="date" value={absenceDate} onChange={e=>setAbsenceDate(e.target.value)} required /></div>
                                                <div className="grid grid-cols-2 gap-3">
                                                    <button type="button" onClick={()=>setMakeupOption('now')} className={`p-4 rounded-xl text-[10px] font-black border ${makeupOption === 'now' ? 'bg-[#005bac] text-white' : 'bg-slate-50 text-slate-400'}`}>ä»Šã™ãæ±ºã‚ã‚‹</button>
                                                    <button type="button" onClick={()=>setMakeupOption('later')} className={`p-4 rounded-xl text-[10px] font-black border ${makeupOption === 'later' ? 'bg-[#005bac] text-white' : 'bg-slate-50 text-slate-400'}`}>å¾Œã§æ±ºã‚ã‚‹</button>
                                                </div>
                                                {makeupOption === 'now' && <div className="space-y-2"><label className="text-[9px] font-black text-slate-400 uppercase ml-1">æŒ¯æ›¿å¸Œæœ›æ—¥</label><input type="date" value={makeupDate} onChange={e=>setMakeupDate(e.target.value)} required /></div>}
                                                <button type="submit" disabled={isSubmitting} className="btn-login-orange italic">é€£çµ¡ã‚’é€ä¿¡ã™ã‚‹</button>
                                                {formStatus && <div className="text-center text-green-600 font-black text-sm">{formStatus}</div>}
                                            </form>
                                        </div>
                                    </div>
                                )}

                                {view === 'settings' && (
                                    <div className="space-y-6 animate-in">
                                        <SubHeader title="Personal" sub="My Account" />
                                        <div className="card p-10 flex flex-col items-center gap-8 relative overflow-hidden text-center border-white">
                                            <div className="w-24 h-24 bg-slate-50 rounded-[2.5rem] flex items-center justify-center text-5xl shadow-inner border border-slate-50">ğŸ‘¤</div>
                                            <div><h3 className="font-black text-xl text-slate-800 leading-none">{studentInfo.name} æ§˜</h3><p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-2 italic">ID: {studentInfo.id}</p></div>
                                            <button onClick={() => { setStudentInfo(null); setView('login'); }} className="text-red-400 font-black text-[10px] uppercase tracking-widest pt-10 active:opacity-50 italic">Logout Academy</button>
                                        </div>
                                    </div>
                                )}
                            </main>

                            <footer className="fixed bottom-8 right-8 z-[150] pointer-events-none">
                                <nav className="bg-white/95 backdrop-blur-md rounded-2xl shadow-[0_15px_35px_rgba(0,0,0,0.15)] border border-white/60 p-4 pointer-events-auto active:scale-90 transition-transform">
                                    <button onClick={() => setView('home')} className={`transition-all ${view === 'home' ? 'text-[#005bac]' : 'text-slate-300 hover:text-[#005bac]'}`}><Icon name="Home" size={24} /></button>
                                </nav>
                            </footer>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
